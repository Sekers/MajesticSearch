<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Search Center</title>
        <script src="js/common.js" type="text/javascript"></script>
        <script src="js/engineList.js" type="text/javascript"></script>
        <link href="css/common.css" rel="stylesheet" type="text/css" />
        <link href="css/popup.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        /******* Top menu *********/
 		
        .suggest
        {
            z-index: 330;
            position: absolute;
            font-weight: normal;
            font-size: 12px;
            list-style-type: none;
            padding-left: 0px;
            margin: 3px 0px 0px 135px;
            background-color: Gray;
            -webkit-border-radius: 0px 0px 3px 3px;
            background-color: #EBEFF9; /*#F0F0F0;*/
            border: solid #B5C7DE;
            border-width: 0px 1.5px 1.5px 1.5px;
            padding: 2px 3px 2px 2px;
        }
        
        
        .suggest li
        {
            margin: 1px 0px 0px 0px;
            padding: 0px 2px 0px 2px;
            -webkit-border-radius: 3px;
        }
        
        
        .suggest li:hover
        {
            cursor: pointer;
            background-color: #B5C7DE; /*#4572CC;*/
            border-width: 1px;
            border-color: #4572CC;
        }
        
        
        /**** bottom menu ****/
        #optionsBox a:hover img
        {
            /*-webkit-transform: rotate(360deg);
            -webkit-transition: all 4s ;*/
        }
        
        
        
        /***** Engine List *****/
        
        .searchEngineListBase
        {
            background: -webkit-gradient(linear, 100% 100%, 0% 100%, from(white), to(white), color-stop(.5,#EBEFF9),color-stop(.8,#EBEFF9),color-stop(.2,#EBEFF9));
            padding-bottom: 10px;
            margin-bottom: 0px;
            -webkit-padding-start: 0px;
            list-style-type: none;
        }
        
        .searchEngineList
        {
            font-family: Calibri,YetAnotherFontBase;
            letter-spacing: .1em;
            margin-top: 30px;
            padding-top: 14px;
        }
        
        
        .smallEngineList
        {
            padding-top: 30px;
            margin-top: 14px;
            padding-left: 15px;
            padding-right: 15px;
        }
        
        
        ul.searchEngineList li:nth-of-type(even) .searchEngine
        {
            float: right;
            margin-right: 25px;
            margin-left: 0px;
        }
        
        /******* Search engine *********/
        .searchEngineListBase .searchEngine
        {
            float: left;
            background-color: white;
            cursor: pointer;
        }
        
        .searchEngineList .searchEngine
        {
            border-width: thick;
            border: 1px solid white; /*#E5E6E0; width:auto;*/
            width: 200px;
            -webkit-border-radius: 8px;
            padding: 5px;
            margin-top: 5px;
            margin-left: 35px;
            -webkit-transition: all .5s;
        }
        
        .smallEngineList .searchEngine
        {
            padding: 3px;
            margin-top: 10px;
            margin-left: 5px;
            -webkit-border-radius: 6px;
            border-color: transparent;
            border-style: solid;
            border-width: 1px;
        }
        
        
        .searchEngineList .searchEngine:hover
        {
            background-color: #FAFAF0;
            -webkit-box-shadow: 2px 2px 2px rgba(0,0, 0, 0.4);
            -webkit-box-shadow: #666 0px 0px 3px;
            -webkit-transition: all 0s;
        }
        
        
        .smallEngineList .searchEngine:hover
        {
            border-color: #EBEFF9;
            -webkit-box-shadow: 2px 2px 2px rgba(0,0, 0, 0.4);
            background: -webkit-gradient(linear, 0% 70%, 0% 100%, from(#FDFDF7), to(#B5C7DE));
        }
        
        
        
        
        
        .smallEngineList .searchEngine:active, .searchEngine[selected="selected"], .searchEngine:hover[selected="selected"]
        {
            border-color: #B5C7DE;
            background: -webkit-gradient(linear, 0% 0%, 0% 70%, from(#B5C7DE), to(#FDFDF7));
            -webkit-box-shadow: 0px 0px 0px rgba(0,0, 0, 0.4);
            border-style: solid;
            border-width: 1px;
        }
        
        .searchEngineList .searchEngine:active
        {
            -webkit-transform: rotate(0deg) scale(.95);
        }
        .smallEngineList .searchEngine:active img, .smallEngineList .searchEngine[selected="selected"]
        {
            -webkit-transform: rotate(0deg) scale(.83);
        }
        
        
        .smallEngineList .searchEngine img
        {
            margin-right: 3px;
        }
        
        .smallEngineList span
        {
            display: none;
        }
        
        
        
        
        .multi
        {
            /*margin:auto;
	        -webkit-border-radius: 6px;
            border-style:solid;
            border-color: #B5C7DE;
            border: 1px solid #B5C7DE;*/
            clear: left;
            overflow: hidden;
            -webkit-transform: rotate(0deg) scale(.83);
        }
        
        
        
        /************ Footer **************/
        
        
        .footer
        {
            color: rgb(18,50,114);
            -webkit-border-radius: 0 0 6px 6px;
            border: 1px solid #B5C7DE;
            font-size: 10pt;
            background-color: White;
            position: absolute;
            z-index: 55;
            bottom: 0px;
            width: 560px;
        }
        
        
        .footer a, .footer a:visited
        {
            color: rgb(18,50,114);
        }
        
        .footerMenuItem
        {
            padding: 3px; /*margin-right:10px;*/
            margin-left: 0px;
        }
        
        .footerMenuItem img
        {
            margin-right: 0px;
            float: left;
        }
        
        .footerMenuItem span
        {
            padding-left: 3px;
            padding-top: 3px;
            vertical-align: top;
            float: left;
        }
        
        
        .footerMessage
        {
            float: left;
            margin: 5px;
        }
    </style>


<script src="js/search.js" type="text/javascript"></script>
<script language="javascript" type="text/ecmascript">
        
//******** intial
var bgPage = chrome.extension.getBackgroundPage();
var engines = bgPage.engines;
var displayEngines;
var displayMulti;
var engineList = new engineList();
this.searchText;


function LoadDefaults() {
    log("loading popup");
    logger.log = log;

    SetPageFocus();
    var enginelistElement = document.getElementById("engineList");
    enginelistElement.className = bgPage.settings.smallButtons ? "searchEngineListBase smallEngineList" : "searchEngineListBase searchEngineList";

    displayEngines = new DisplayEngines("engineList");
  //  displayMulti = new DisplayEngines("multiList");
    
    var searchBox = document.getElementById("searchText");
    searchBox.focus();

    //wires up hotkey events
   // searchBox.addEventListener('keydown', function() {alert('ping') }, false);
    searchBox.addEventListener('keydown', searchTextKeyPress, false);

    searchText = new textBoxManager(bgPage.settings.useSuggest); //come up with a better name than textman & searchttext... textvalueManager
   // this.searchText.init();//since init starts an asyc call to bgpage, must make sure the callback is ready (depends on textManager)
        

    engines.forEach(function(engine) {
        displayEngines.DrawEngine(engine);
    });

    


	//set the defaultsearch
    var defaultEngine = bgPage.getDefaultEngine();
    var defaultImage = document.getElementById("defaultSearchImage");
    var defaultSearchDiv = document.getElementById("defaultSearchDiv");//maybe can attach to image, mouse button may have been dodgy
    defaultSearchDiv.title = defaultEngine.SearchEngineName;  
    defaultSearchDiv.setAttribute("onmouseup", "defaultSearch(tabBehaviour.fromMouse(event))");

    //TODO LOW needs to be updated, when order of engines are updated (use nofication)
    defaultImage.src = getCachedImage(defaultEngine.IconUrl);

//rename to newFeatures or displaynewfeatures
    initFeatures();


    document.body.addEventListener("mouseup", function() { searchText.hideDropDown(); }, false);

    //set search current site
    chrome.tabs.getSelected(null, function (tab) {
        var address = tab.url;
        //bug check that it an actual domain (e.g try doing when from popup.html is in the address bar, could this happen other times?)
        var domain = getDomain(address); //.toString().match(/^https?:\/\/([^\/]*)\//ig)[0];
        log("domain:" + domain);
        var currentSiteImage = document.getElementById("searchCurrentSiteImg");
        currentSiteImage.src = "chrome://favicon/" + domain; //"/images/add.png";

        //get
        currentSiteImage.onload = function () {

            // alert(bgPage.imageCache.toDataUrl(currentSiteImage));
            var currSite = document.getElementById("currentSiteDiv");
            currSite.setAttribute("style", "");
            currSite.title = "search " + domain;
        }

        currentSiteImage.setAttribute("onmouseup", "searchCurrentSite()");
        // currentSiteImage.addEventListener("onmouseup", function () { alert('ping'); }, false);
        //fix  getdomain
        //fix  
        //look for opensearch first, perhaps save it 



    });
    
}


//************* public methods


//when calling a function from a view
//the 'this' is set to window
//so we set up our own context

this.publicMethods = new function(context){ 
  //  var context = context;

    //no real point making it json
    return { selectedTextFound: function(result) {
                                    context.searchText.setSelectedText(result);
                                }
           }
    
    
} (this);



function drawEngine(engine) {
   displayEngines.DrawEngine(engine);
}

function openSearchAdded() {
    showStatus("websiteAdded");
};

function addSiteError() {
    showStatus("openSearchError");
};

function addSiteUnsupported() {
    showStatus("noOpenSearch");
}


//************ todo make private


function DisplayEngines(nodeId) {
    
    var ulCol = document.getElementById(nodeId);

    this.DrawEngine = function(engine) {
        ulCol.appendChild(CreateEngineNode(engine));
    };


    function CreateEngineNode(SearchEngineData) {
        var li = document.createElement("li");
        li.setAttribute("title", SearchEngineData.SearchEngineName);
        li.setAttribute("alt", SearchEngineData.SearchEngineName);
        var div = document.createElement('div');

        div.setAttribute("onmouseup", "engineClick(this,event,'" + SearchEngineData.Id + "')");

        var span = document.createElement('span');
        span.appendChild(document.createTextNode(SearchEngineData.name));

        var img = document.createElement('img');
        img.setAttribute("src", getCachedImage(SearchEngineData.IconUrl));

        div.appendChild(img);
        div.appendChild(span);
        div.setAttribute("class", "searchEngine");
       

        li.appendChild(div);
        return li;
    }

 }


function getCachedImage(imageUrl) {
    return bgPage.getCachedImage(imageUrl);
}

//make obsolete
//refact could renume to currentseachText... could we make it a property?
function GetSearchTerm() {
    return searchText.searchTerm();
}






//******************************* Textbox manager


function textBoxManager(useSuggest) {
    //think about removeing edit mode
     //-3,-2,-1,0[,select],0,1,2,3
    console.log("loading textBoxManager");

    var self = this;
    var editText ="";//maybe remember the current user key input
    var searchBox = document.getElementById("searchText");
    var suggestList = null;
    var suggestElement = document.getElementById("suggest");
    var suggestDataSource;
    
    var status = {
        current: null, selection: "selection", edit: "edit", last: "last",suggest:"suggest",
        setStatus: function(mode) {
            this.current = mode;
        },
        isCurrent: function(mode)
        { return current == mode },
        selectedText: null,
        //can we make this into a propery?
        hasSelection: function() { return this.selectedText != null }, 
        index: 0

    }


    this.init = function() {
        //set last search
        applyLastText();

        //async call to get selected text
        bgPage.getSelection();


        suggestElement.addEventListener('mouseup', suggestionClicked, false);
        //suggestElement.addEventListener('click', suggestionClicked, false);
        suggestElement.addEventListener('dblclick', function(event) {
            defaultSearch(tabBehaviour.fromKeyPress(event));
        }, false);

        searchBox.addEventListener('keydown', SearchTextBoxKeyPress, false);

        //  searchBox.addEventListener('keypress',getSuggestions, false);

        if (useSuggest)
            searchBox.addEventListener('keyup', getSuggestions, false);


        searchBox.addEventListener("mouseup", function(event) {
            if (event.button == 2) {
                if (suggestDataSource === bgPage.searchHistory.history) {
                    //var d = [];
                    displayDropDown();
                } else {
                    displayDropDown(bgPage.searchHistory.history);
                }
            }
            event.stopPropagation();
        }, false);



        //var body = document.getElementById("body");
        //body.addEventListener("mousedown", hideDropDown, false);
        //body.addEventListener("click", hideDropDown, false);


        document.addEventListener('mousewheel', function(wheelEvent) {
            //should i prevent default?
            //should i do mutile ups for a big scroll
            //analytics would be good to see if anything but 1/-1 is used
            wheelEvent.wheelDelta /* 120*/ > 0 ? up() : down();
        }, false);

        searchBox.addEventListener('keyup', function(keyEvent) {

            if (keyEvent.keyCode == 38 || keyEvent.keyCode == 40) {               
                searchBox.select();
            }
        }, false);

    };

 
    this.setSelectedText = function(text) {
       
        status.selectedText = text;
        
        applySelectedText();
    }

    function applySelectedText()  {
        status.setStatus(status.selection);
        setSearchText(status.selectedText);
    }
    function applyLastText(index) {
        index = index || 0;
          var text = bgPage.searchHistory.term(index);
          if (text) {
              status.index = index;
              setSearchText(text);
              status.setStatus(status.last);
          }
      }



      function highlightSuggest(index) {
          
          //check it exists first
          if (suggestList && suggestList[index]) {
              
              status.setStatus(status.suggest);
              clearSelectedSuggest();
              suggestElement.children[index].setAttribute("style", "background-color:#B5C7DE");
              setSearchText(suggestElement.children[index].innerText);

              status.index = index;
          }

      }


      function applyEditText() {
          
          
        status.setStatus(status.edit);
        setSearchText(editText);
    }

    function customTextEntered() {
        //when you enter a key is should to to edit mode
        status.setStatus(status.edit);
        status.index = 0;
    }

    function setSearchText(text) {
        searchBox.value = text;
        searchBox.select(); 
    }


//todo turn into property
    this.searchTerm = function() {
        return searchBox.value;
    }


    function SearchTextBoxKeyPress(keyEvent) {
        
        switch (keyEvent.keyCode) {
            case 38:
                keyEvent.preventDefault();
                up();
                break;
            case 40:
                keyEvent.preventDefault();
                down();
                break;
            default://should only be called if text changes
                customTextEntered();
        }
        //on backspace
        //todo check that a key has been pressed
    }

    function up() {

        switch (status.current) {
            case status.suggest:
                if (status.index != 0) {
                    highlightSuggest(status.index - 1);
                    break;
                }
                applyEditText();
                clearSelectedSuggest();
                break;
                
            case status.edit:
                editText = self.searchTerm(); 
                if (status.hasSelection()) {
                    applySelectedText();
                    break;
                }
            case status.selection:
                applyLastText();
                break;
            case status.last:
              
                applyLastText(status.index + 1);
                break;

        }
    
    }

    function down() {
        switch (status.current) {
            case status.last:
                if (status.index > 0) {
                    applyLastText(status.index - 1);
                    break;
                }
                if (status.hasSelection()) {
                    applySelectedText();
                    break;
                }
            case status.selection:
                applyEditText();
                break;
            case status.edit:
                editText = self.searchTerm();
                highlightSuggest(status.index);
                break;
            case status.suggest:
                highlightSuggest(status.index + 1);
                break;
        }
     }

     function clearSelectedSuggest() {
         for (var i = 0; i < suggestElement.children.length; i++)
         {
             suggestElement.children[i].removeAttribute("style");
         }
         
     }

     function suggestionClicked(event) {
         
         
         if (event.srcElement instanceof HTMLLIElement)
         {
             switch (event.button) {
                 case 0:
//                     clearSelectedSuggest();
//                     //find  element that matches  and set it to selected
//                     status.setStatus(status.suggest);
//                     for (var i = 0; i < suggestElement.children.length; i++) {
//                         if (suggestElement.children[i] === event.srcElement)
//                             status.index = i;
//                     }

                     //event.srcElement.setAttribute("style", "background-color:#B5C7DE");
                     setSearchText(event.srcElement.innerText);
                     hideDropDown();
                     break;
                 case 1: //middle
                 case 2: //right click
                     defaultSearch(tabBehaviour.fromMouse(event), event.srcElement.innerText);
                     break;
             
             } 
        }
        event.stopPropagation();
        event.cancelBubble = true;
     }


     function getSuggestions(event) {
        // log(searchText.searchTerm() + String.fromCharCode(event.charCode));
         if (event.keyCode != 40 && event.keyCode != 38) {
             bgPage.GetJSON("http://clients1.google.com/complete/search?client=chrome&hl=en-GB&q=" + searchText.searchTerm() + String.fromCharCode(event.charCode),
                function(json) {

                    suggestList = json[1];

                    displayDropDown(suggestList);



                });
            }
           
     }

     function displayDropDown(list) {

         suggestDataSource = list;
         while (suggestElement.hasChildNodes()) {
             suggestElement.removeChild(suggestElement.childNodes[0]);
         }

         if (list && list.length >= 1) {
             suggestElement.style.display = "block";

             list.forEach(function(suggestion) {

                 var d = document.createElement("li");
                 d.appendChild(document.createTextNode(suggestion));
                 suggestElement.appendChild(d);

             });             
             
         } else {
            suggestElement.style.display = "none";
         }
        
     }

     function hideDropDown() {
         // alert('ping');
        // alert(suggestElement.style.display);
         suggestElement.style.display = "none";
         while (suggestElement.hasChildNodes()) {
             suggestElement.removeChild(suggestElement.childNodes[0]);
         }
         
     }

    this.init();
    this.hideDropDown = hideDropDown;

};


    



function searchTextKeyPress(e) {


    if (e.shiftKey && e.keyCode == 13) {
        searchCurrentSite();

    } else {
        switch (event.keyCode) {
            case 13: 
            defaultSearch(tabBehaviour.fromKeyPress(e)); 
            break;
        }
     }
}




/** mouse enum **/

//function mouseClickType() { }

//mouseClickType.calculate = function(event) {
//    //alert(event.button);
//    switch (event.button) {
//        case 0:
//            return mouseClickType.left;
//        case 1: return mouseClickType.middle; //test this!!!
//        case 2: return mouseClickType.right;
//            break;
//    }
//  

//};
////instead if int we could have objects
////and use isLeft(mouseobject) { if is instancof mouseobject}
////try to avoid using == with this
//mouseClickType.left = 0;
//mouseClickType.right = 2;
//mouseClickType.middle = 1;







//turn NEw/Overwirte into objects  tab.IsNew()

function tabBehaviour()
{ };
tabBehaviour.New = 0;//each search is in a new tab
tabBehaviour.OverWrite = 1;//makes the first search to update the current tab, the rest are new
tabBehaviour.Multi=2;//opens new tabs... but does not close popup
tabBehaviour.fromMouse = function(click) {
log("mouse");
switch (event.button) {
    
        case 0:
            return bgPage.getOpenSearchInSameTab() ? tabBehaviour.OverWrite : tabBehaviour.New;
        case 1: return tabBehaviour.New;
        case 2: return tabBehaviour.Multi;
            break;
    }
};
tabBehaviour.fromKeyPress = function(keyPress) {
return bgPage.getOpenSearchInSameTab() ? tabBehaviour.OverWrite : tabBehaviour.New;
}



function engineClick(sender,event, engineId) {
    var tabAction = tabBehaviour.fromMouse(event);
    switch (tabAction) {
        case tabBehaviour.Multi:
            //multiClick(sender,engineId);
            searchById(engineId, GetSearchTerm(), false);
            break;
        case tabBehaviour.New:
            searchById(engineId, GetSearchTerm(), false);
            break;
        case tabBehaviour.OverWrite:
            searchById(engineId, GetSearchTerm(), true);
            break;
    }
    

    if (event.button == 0) {
        window.close();
    }
    event.cancelBubble = true;
    return true;
}


//TODO multi click is no longer used... remove
function multiClick(sender,engineId) {
    var eng = engines.findEngineById(engineId);
    
    if (sender.getAttribute("selected")) {
        sender.removeAttribute("selected");
        engineList.remove(engineId);
    }
    else {
        engineList.add(engineId);
        sender.setAttribute("selected", "selected");
    }
}

//TODO background
function searchById(engineId, terms, sameWindow) {

//may have to push last engine Id on
    engineList.add(engineId);
    log(engineList.returnList());
    bgPage.searchList(engineList.returnList(), terms, sameWindow);

    //reset
    engineList.clear();
   
//maybe this engine list should be passed in
////////////    engineList.forEach(function(currentEngineId) {
////////////        if (engineId != currentEngineId)//don't search on last pressed 
////////////        {
////////////            bgPage.searchById(currentEngineId, terms, false);
////////////        } else {
////////////            //already selected so assume the window wants to be opened in the background
////////////            sameWindow = false;
////////////        }
////////////    });
////////////    return bgPage.searchById(engineId, terms, sameWindow);




}

//TODO background
function searchByEngine(engine, terms, sameWindow) {
    return bgPage.searchByEngine(engine, terms, sameWindow);
}

//todo try not to directly use this as it is only for item that don't exist in the enginelist
//todo background... mybe even make private
//e.g a google sitesearch
//in the future thing like last engine used won't work here
function searchByUrl(url, terms,sameWindow) {
    return bgPage.searchByUrl(url, terms, sameWindow);

 }


 //could compile this in background page
 function defaultSearch(tabAction, searchQuery) {
     var sameWindow = tabAction == tabBehaviour.OverWrite;

     if (!searchQuery) {
         searchQuery = GetSearchTerm();
     }

     bgPage.defaultSearch(searchQuery, sameWindow);
     //todo should call tabAction.shouldClose()
     if (tabAction != tabBehaviour.Multi)
         window.close();
}

//TODO should we move this into searchHelper also would have to return engine (which may involve a temp googlesite engine
function searchCurrentSite() {
    //get current domain
    chrome.tabs.getSelected(null, function(tab) {

        var address = tab.url;
        //bug check that it an actual domain (e.g try doing when from popup.html is in the address bar, could this happen other times?)
        var domain = getDomain(address); //.toString().match(/^https?:\/\/([^\/]*)\//ig)[0];
        log("domain:" + domain);

        bgPage.searchDomain(domain, GetSearchTerm());
    });

}
    
function log(message) {
    console.log(message);
    bgPage.log(message);
}

function inspect(obj) {
    bgPage.inspect(obj);
}

function showOptionsPage() {
    chrome.tabs.create({ url: "options.html"});
}

function openNewPage(anchor) {
    chrome.tabs.create({ url: anchor.href });
    return false;
}

 //**************************************************************//

 function initFeatures() {
     if (bgPage.version.hasNewFeatures()) {
         showElement('newFeatures');
     }
 }


 function viewFeaturePage() {
     chrome.tabs.create({ url: "features.html" });
     hideFeatures();
 }
 

 function hideFeatures() {
     bgPage.version.disableNewFeatures();
     hideElement('newFeatures');
 }
       
        
//************************ manage engines ***********************//


function addCurrentSite() {
    showStatus("loading");
    log("loading");
    bgPage.addCurrentWebsite();  
}

function showStatus(code) {
    switch (code) {

        case "loading":
            hideElement("addSite");
            showElement("loading");
            break;
        case "noOpenSearch":
            hideElement("addSite");
            hideElement("loading");
            
            //todo should strip http:// and trailing slash
            chrome.tabs.getSelected(null, function(tab) {
                document.getElementById("mycroftLink").href = "http://mycroft.mozdev.org/search-engines.html?name=" + getDomain(tab.url) + "&opensearch=yes";
            });
            showElement("addFailed");
            showElement("noOpenSearch");
            break;
        case "openSearchError":
            hideElement("addSite");
            hideElement("loading");
            
            showElement("addFailed");
            showElement("openSearchError");
            break;
        case "websiteAdded":
            hideElement("addSite");
            hideElement("loading");
            showElement("websiteAdded");
            break;
        
    }

}

function showElement(elementName) {
    var element = document.getElementById(elementName);
    element.style.display = "block";
    element.style.visibility = "visible";
}

function hideElement(elementName) {
    var element = document.getElementById(elementName);
    element.style.display = "none";
}


</script>

</head>
<body onload="LoadDefaults()" id="body" >
   
    <div class="titleBar" >
        <div >Search Center</div>
        


        
        <input id="searchText" autofocus="autofocus"  type="text"/>


        <div id="defaultSearchDiv" class="titleButton" >
            <img alt="" src="" id="defaultSearchImage"   width="16"  />
        </div>
        <div id="currentSiteDiv" class="titleButton" style="display:none" >
            <img alt="" src="" id="searchCurrentSiteImg"   width="16"  />
        </div>
 
    </div>
   <ul id="suggest" class="suggest" style="display:none" ></ul>



        <ul class=""   id="engineList" style="overflow:auto" ><!--style="left:50%;position:relative"-->
 
            
        </ul>

  <div style="clear:both;margin-bottom:28px;"></div>
        

    <div class="footer" >
        <div id="optionsBox" class="footerMenuItem left">
            <a href="/" onclick="showOptionsPage()">
                <img width="20" src="images/process.png" />
                <span>Options</span></a>
        </div>
        <div class="footerMenuItem left" id="newFeatures" style="background-color: Orange;
            margin-left: 95px; -webkit-border-radius: 8px; display: none">
            <a href="features.html" onclick="viewFeaturePage()">
                <img width="20" src="images/light_bulb.png" />
                <span>New Features</span></a><span style="color: White; padding-right: 3px;">|</span>
            <img width="20" onclick="hideFeatures()" src="images/delete.png" />
        </div>
        <div id="addSite" class="footerMenuItem right">
            <a onclick="addCurrentSite()" href="">
                <img width="20" src="images/add.png" />
                <span>Add current website</span></a>
        </div>
        <div id="loading" class="footerMenuItem right hide">
            <img alt="busy" width="18" src="images/Cursor_Windows_Vista.gif" />
            <span>Adding website...</span>
        </div>
        <div id="websiteAdded" class="footerMenuItem right hide">
            <img src="images/accept.png" width="20" />
            <span>Website added.</span></div>
        <div id="addFailed" class="footerMenuItem right hide">
            <img src="images/warning.png" width="20" />
            <span>Could not add website.</span>
        </div>
        <div id="openSearchError" class="footerMessage hide">
            Oops, something went wrong, this website cannot be added automatically at this time.
            If you can let me know what site you are trying to add by posting it in the <a href="https://wave.google.com/wave/#restored:wave:googlewave.com!w%252BBO2DwEQbA"
                onclick="openNewPage(this)">search center public wave</a>, I'll try and fix
            it.</div>
        <div id="noOpenSearch" class="footerMessage hide">
            Sorry, this website cannot <b>currently</b> be added automatically. To add this
            website you can try any of the following:
            <ul>
                <li>Train the website by seaching for: <b>searchcenter</b> in the website you want to add, then click "add the current website"
                    again.</li>
                <li>Search <a id="mycroftLink" href="http://mycroft.mozdev.org/" onclick="openNewPage(this)">
                    mycroft</a> for your domain.</li>
                <li>Add site manualy from the <a href="options.html" onclick="showOptionsPage()">options
                    page</a>.</li>
            </ul>
        </div>
        <div style="clear: both">
        </div>
        <div style="margin-left: auto; margin-right: auto; text-align: center; padding-top: 5px;
            display: none">
            <div style="background-color: Orange; display: inline-block; padding: 5px; -webkit-border-radius: 8px;">
                <a href="features.html" onclick="viewFeatures(this)">New Features!</a>
                <img src="images/delete.png" width="20" />
            </div>
        </div>
    </div>
    
    
    
 




   
   
   
</body>
</html>
